<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header with Actions -->
  <div class="max-w-4xl mx-auto mb-6 flex flex-wrap gap-3 justify-between items-center no-print">
    <h1 class="text-2xl font-bold text-gray-800">Payment Receipt</h1>
    <div class="flex flex-wrap gap-2">
      <button pButton 
              label="Print Receipt" 
              icon="pi pi-print" 
              severity="info"
              (click)="printReceipt()"
              [disabled]="downloading || loading">
      </button>
      <button pButton 
              label="Download PDF" 
              icon="pi pi-download" 
              severity="success"
              (click)="downloadPDF()"
              [loading]="downloading"
              [disabled]="downloading || loading">
      </button>
      <button pButton 
              label="Share" 
              icon="pi pi-share-alt" 
              severity="secondary"
              class="p-button-outlined"
              (click)="shareReceipt()"
              [disabled]="downloading || loading">
      </button>
      <button pButton 
              label="Back" 
              icon="pi pi-arrow-left" 
              severity="secondary"
              class="p-button-outlined"
              (click)="goBack()"
              [disabled]="downloading || loading">
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-12 text-center">
    <p-progressSpinner></p-progressSpinner>
    <p class="mt-4 text-gray-600">Loading receipt...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="max-w-4xl mx-auto bg-red-50 border border-red-200 rounded-xl p-8 text-center no-print">
    <i class="pi pi-exclamation-triangle text-4xl text-red-500 mb-4"></i>
    <h2 class="text-xl font-bold text-red-700 mb-2">Something went wrong</h2>
    <p class="text-red-600 mb-4">{{ errorMessage }}</p>
    <button pButton 
            label="Try Again" 
            icon="pi pi-refresh" 
            (click)="retry()">
    </button>
  </div>

  <!-- PDF Generation Progress -->
  <div *ngIf="downloading" class="max-w-4xl mx-auto mb-6 bg-white rounded-xl shadow-lg p-6 no-print">
    <div class="flex items-center justify-between mb-2">
      <span class="text-sm font-medium text-gray-700">Generating PDF...</span>
      <span class="text-sm font-medium text-primary-600">{{ pdfProgress }}%</span>
    </div>
    <p-progressBar [value]="pdfProgress" styleClass="h-2"></p-progressBar>
    <p class="text-xs text-gray-500 mt-2">Please wait while we prepare your receipt</p>
  </div>

  <!-- Screen View Receipt (Styled for screen) -->
  <div *ngIf="!loading && !errorMessage && receipt" 
       class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden no-print">
    
    <!-- Screen Receipt Header -->
    <div class="bg-gradient-to-r from-primary-600 to-primary-700 text-white px-8 py-6">
      <div class="flex justify-between items-center">
        <div>
          <div class="flex items-center space-x-3">
            <i class="pi pi-graduation-cap text-3xl"></i>
            <h1 class="text-2xl font-bold">Digital Gateway</h1>
          </div>
          <p class="text-primary-100 mt-1">Training Institute</p>
        </div>
        <div class="text-right">
          <p class="text-sm text-primary-100">Receipt #</p>
          <p class="text-xl font-mono font-bold">{{ receipt.receiptNumber }}</p>
        </div>
      </div>
    </div>

    <!-- Screen Receipt Body -->
    <div class="p-8">
      <!-- Status Badge -->
      <div class="flex justify-end mb-6">
        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
          PAID
        </span>
      </div>

      <!-- Info Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="space-y-4">
          <div>
            <p class="text-sm text-gray-500">Payment Date</p>
            <p class="text-lg font-semibold">{{ receipt.date | date:'fullDate' }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Payment Mode</p>
            <div class="flex items-center space-x-2">
              <i [class]="getPaymentModeIcon(receipt.paymentMode)" class="text-primary-600"></i>
              <p class="text-lg font-semibold">{{ receipt.paymentMode | titlecase }}</p>
            </div>
          </div>
        </div>
        <div class="space-y-4">
          <div>
            <p class="text-sm text-gray-500">Payment Number</p>
            <p class="font-mono text-sm">{{ receipt.paymentNumber }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Received By</p>
            <p class="font-semibold">{{ receipt.receivedBy }}</p>
          </div>
        </div>
      </div>

      <!-- Student Details Card -->
      <div class="bg-gray-50 rounded-xl p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
          <i class="pi pi-user mr-2 text-primary-600"></i>
          Student Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500">Full Name</p>
            <p class="font-medium text-gray-800">{{ receipt.student.name }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Email Address</p>
            <p class="text-gray-600">{{ receipt.student.email }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Phone Number</p>
            <p class="text-gray-600">{{ receipt.student.phone }}</p>
          </div>
          <div *ngIf="receipt.student.address">
            <p class="text-sm text-gray-500">Address</p>
            <p class="text-gray-600">{{ receipt.student.address }}</p>
          </div>
        </div>
      </div>

      <!-- Course Details Card -->
      <div class="bg-gray-50 rounded-xl p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
          <i class="pi pi-book mr-2 text-primary-600"></i>
          Course Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-500">Course Name</p>
            <p class="font-medium text-gray-800">{{ receipt.course.name }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Course Code</p>
            <p class="font-mono text-gray-600">{{ receipt.course.code }}</p>
          </div>
        </div>
      </div>

      <!-- Payment Summary -->
      <div class="border-2 border-primary-100 rounded-xl p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold text-gray-800">Payment Summary</h3>
          <i class="pi pi-check-circle text-2xl text-green-500"></i>
        </div>
        <div class="space-y-3">
          <div class="flex justify-between text-lg">
            <span class="text-gray-600">Amount Paid:</span>
            <span class="font-bold text-green-600">Rs {{ receipt.amount | number }}</span>
          </div>
          <div class="border-t border-gray-200 pt-3">
            <p class="text-sm text-gray-600">Amount in Words:</p>
            <p class="font-medium text-gray-800">{{ receipt.amountInWords }}</p>
          </div>
          <div *ngIf="receipt.transactionReference" class="pt-2">
            <p class="text-sm text-gray-600">Transaction Reference:</p>
            <p class="font-mono text-sm">{{ receipt.transactionReference }}</p>
          </div>
        </div>
      </div>

      <!-- Footer Note -->
      <div class="text-center text-sm text-gray-500">
        <p>This is a computer generated receipt. No signature required.</p>
        <p class="text-xs text-gray-400 mt-2">Generated on: {{ receipt.timestamp | date:'medium' }}</p>
      </div>
    </div>
  </div>

  <!-- Print receipt component (hidden on screen) -->
  <app-print-receipt [receipt]="receipt"></app-print-receipt>
</div>